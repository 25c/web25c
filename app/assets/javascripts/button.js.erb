/* Button
 *
 * The code that is run on the publisher's page which draws the button.
 * drawn in this way:
 *     <script src="http://25c.com/assets/button.js?uuid={user id}"></script>
 **/
;(function() {
  var scriptSource = (function() {
    var scripts = document.getElementsByTagName('script'),
      script = scripts[scripts.length - 1];
    if (script.getAttribute.length !== undefined) {
      return script.getAttribute('src');
    }
    return script.getAttribute('src', 2);
  }());
  
  function getValue(name) {
    var query = scriptSource.split('?')[1];
    var vars = query.split("&");
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split("=");
      if (pair[0] == name) {
        return unescape(pair[1]);
      }
    }
  }

  // TODO(duane): make this more secure so javascript can't be entered into the url
  var uuid = getValue('uuid');
  var type = getValue('type');
  var baseUrl = '<%= ActionMailer::Base.default_url_options[:host] + (ActionMailer::Base.default_url_options[:port].nil? ? '' : ":#{ActionMailer::Base.default_url_options[:port]}") %>';
  var dimensionsMap = {
    '1': { width: 60, height: 60 },
    '2': { width: 24, height: 25 }
  };
  document.write('<iframe width="' + dimensionsMap[type].width + '" height="' + dimensionsMap[type].height + '" frameborder="0" border="0" scrolling="none" src="http://' + baseUrl + '/button/' + uuid + '?type=' + type + '" style="vertical-align: middle; display: inline-block; *display: inline; *zoom: 1;"></iframe>');
}());